<%
const posts = Array.isArray(blogPosts) ? blogPosts : [];

function toAbsoluteUrl(href) {
    if (!href || typeof href !== 'string') {
        return canonicalUrl;
    }

    if (/^https?:\/\//i.test(href)) {
        return href;
    }

    const normalizedPath = href.startsWith('/') ? href : `/${href}`;
    return `https://lovart.info${normalizedPath}`;
}

const itemListElement = posts.map((post, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    name: post.title,
    url: toAbsoluteUrl(post.url)
}));

const blogPostingItems = posts.map((post) => ({
    '@type': 'BlogPosting',
    headline: post.title,
    description: post.desc,
    url: toAbsoluteUrl(post.url),
    datePublished: post.datePublished,
    author: {
        '@type': 'Person',
        name: post.author
    }
}));
%>
<script type="application/ld+json">
<%- JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'Blog',
    name: t.blog_page.hero.title,
    description: t.blog_page.hero.desc,
    url: canonicalUrl,
    inLanguage: lang,
    publisher: {
        '@type': 'Organization',
        name: 'Lovart',
        url: 'https://lovart.info'
    },
    blogPost: blogPostingItems
}, null, 2) %>
</script>

<script type="application/ld+json">
<%- JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'ItemList',
    itemListElement
}, null, 2) %>
</script>
